	Если ОлдТекПоз=ТекущийЭлемент() Тогда Возврат ""; КонецЕсли;
	
	ОлдТекПоз = ТекущийЭлемент();
	КурТекПоз = ТекущийЭлемент();
	ТабПоставки.УдалитьСтроки();
	Поставка=СоздатьОбъект("Справочник.Поставки");
	Поставка.ИспользоватьВладельца(ТекущийЭлемент());
	Поставка.ВыбратьЭлементы();                               
	Пока Поставка.ПолучитьЭлемент() = 1 Цикл 
		Если Поставка.НаличиеОстатка=глЛожь Тогда Продолжить;КонецЕсли;
		ТабПоставки.НоваяСтрока();
		//ТабПоставки.Системная 	    = "BRUSH_S["+глПолучитьЦвет(212,221,244)+"]"; 
		
		Если ПустоеЗначение(ТекущийЭлемент().КодКНАМ)=1 Тогда 
			ТабПоставки.Системная 	    = "BRUSH["+глПолучитьЦвет(224,255,125)+"]"+"COUNT[0]"; 
		Иначе 
			ТабПоставки.Системная 	    = "BRUSH["+глПолучитьЦвет(224,255,125)+"]"+"COUNT[5]";
		КонецЕсли;
		
		ТабПоставки.ЦенаОтпуска	    = Формат(Поставка.ЦенаОтпуска,"Ч10.2");
		ТабПоставки.Серия      	    = СокрЛП(Поставка.Серия);
		ТабПоставки.Остаток			= Формат(Регистр.ОстатокТовара.СводныйОстаток(КурТекПоз, Поставка.ТекущийЭлемент(),"Остаток"),"Ч12.3");
		ТабПоставки.СрокГодности    = Поставка.СрокГодности;
	    // Бонус в 4% от стоимости для фармацевтов наглядно
		ТабПоставки.Бонус			= ?(КурТекПоз.ПризнакТовара = Перечисление.ПризнакиТоваров.Импортируемый, Формат(Поставка.ЦенаОтпуска*4/100,"Ч10.2"), "0.00");
		
		// Выводим вид поставки
		Вид = "";
	    Попытка Вид = Поставка.Док.ТипПоставки; Исключение Вид = ""; КонецПопытки;
        ТабПоставки.ТипПост			= Вид;
		
		
		// Показываем сену с учетом компенсации для льготных медикаментов
		// Пересчитываем под льготный процент 
		Если (Константа.ПересчетПодЛьготныйПроцент = Перечисление.Булево.Да) И (КурТекПоз.КодКНАМ.Выбран()=1)  И (КурТекПоз.КолВоДоз<>0) Тогда
			// Песчитываем под льготный процент ТОЛЬКО в случае если товар был расценен под более высокий процент!
			Процент 		 = ?(Константа.ЛьготныйПроцент>Поставка.Процент, Поставка.Процент, Константа.ЛьготныйПроцент);
			ЦенаПриобретения 	 = Поставка.ЦенаПриобретения;
			ЦенаНулевая   	 	 = ?(Поставка.ЦенаНачальная<>0, Поставка.ЦенаНачальная, ЦенаПриобретения);	// Нулевая
			ПроцентНДС       	 = глСтавкаНДС(КурТекПоз.СтавкаНДС);  	 									// % НДС
			ЦенаПод15			 = (ЦенаНулевая*(Процент/100)+ЦенаПриобретения) * (ПроцентНДС / 100 +1);    // цена под 15% наценки
			ЦенаНаДозуПод15 	 = ЦенаПод15/КурТекПоз.КолВоДоз;
			КомпНаДозуМакс  	 = КурТекПоз.КодКНАМ.КомпНаДозуМакс;
				

			// Сумма компенсации
			СуммаКомп1 = 0;
			СуммаКомп2 = 0;
			Если (КурТекПоз.КодКНАМ.ТипКНАМ=Перечисление.ТипыКНАМ.Условно)    Тогда  
				СуммаКомп1 = ?(ЦенаНаДозуПод15>КомпНаДозуМакс, (КурТекПоз.КодКНАМ.КомпНаДозуК1*КурТекПоз.КолВоДоз), ЦенаПод15);	// Компенсация для взрослых
			    СуммаКомп2 =?(ПустоеЗначение(КурТекПоз.КодКНАМ.КодКНАМ2)=1, 0, ЦенаПод15); 										// Компенсация < 18
			КонецЕсли;
			
			Если (КурТекПоз.КодКНАМ.ТипКНАМ=Перечисление.ТипыКНАМ.Частично)   Тогда  
				СуммаКомп1 = ?(ЦенаНаДозуПод15>КомпНаДозуМакс, (КурТекПоз.КодКНАМ.КомпНаДозуК1*КурТекПоз.КолВоДоз), ЦенаПод15);
			КонецЕсли;
			
			Если (КурТекПоз.КодКНАМ.ТипКНАМ=Перечисление.ТипыКНАМ.Процент100) Тогда  
				СуммаКомп1 =ЦенаПод15; 
			КонецЕсли;

			ТабПоставки.ЦенаКомп1 =?((ЦенаПод15-СуммаКомп1)<0, "0.00", Формат(ЦенаПод15-СуммаКомп1,"Ч10.2"));
			ТабПоставки.ЦенаКомп2 =?((ЦенаПод15-СуммаКомп2)<0, "0.00", Формат(ЦенаПод15-СуммаКомп2,"Ч10.2"));
			
			ТабПоставки.КодКНАМ1  = СокрЛП(КурТекПоз.КодКНАМ.КодКНАМ1); 
			ТабПоставки.КодКНАМ2  = СокрЛП(КурТекПоз.КодКНАМ.КодКНАМ2); 
            
			// Для наилучшего визуального представления
			ТабПоставки.КодКНАМ1  =?(ПустоеЗначение(КурТекПоз.КодКНАМ.КодКНАМ1)=1, "Нет", ТабПоставки.КодКНАМ1);
			ТабПоставки.КодКНАМ2  =?(ПустоеЗначение(КурТекПоз.КодКНАМ.КодКНАМ2)=1, "Нет", ТабПоставки.КодКНАМ2);
			ТабПоставки.ЦенаКомп1 =?(ПустоеЗначение(КурТекПоз.КодКНАМ.КодКНАМ1)=1, "Нет", ТабПоставки.ЦенаКомп1);
			ТабПоставки.ЦенаКомп2 =?(ПустоеЗначение(КурТекПоз.КодКНАМ.КодКНАМ2)=1, "Нет", ТабПоставки.ЦенаКомп2);
		
		ИначеЕсли (Константа.ПересчетПодЛьготныйПроцент = Перечисление.Булево.Да) И (КурТекПоз.КодКНАМ.Выбран()=1) И(КурТекПоз.КолВоДоз=0) Тогда
			// Сообщение об отсутствии доз
			ТабПоставки.КодКНАМ1  = СокрЛП(КурТекПоз.КодКНАМ.КодКНАМ1); 
			ТабПоставки.КодКНАМ2  = СокрЛП(КурТекПоз.КодКНАМ.КодКНАМ2); 
			ТабПоставки.КодКНАМ1  =?(ПустоеЗначение(КурТекПоз.КодКНАМ.КодКНАМ1)=1, "Нет", ТабПоставки.КодКНАМ1);
			ТабПоставки.КодКНАМ2  =?(ПустоеЗначение(КурТекПоз.КодКНАМ.КодКНАМ2)=1, "Нет", ТабПоставки.КодКНАМ2);
			ТабПоставки.ЦенаКомп1 ="Нет/Доз";
			ТабПоставки.ЦенаКомп2 ="Нет/Доз";
		КонецЕсли;
	КонецЦикла; 
 
    
	ТабПоставки.ТекущаяСтрока(ТабПоставки.КоличествоСтрок());
	// Устанавливаем последний товар на которм остановился курсор
	// глПоледнийТовар=ТекущийЭлемент();
	Возврат "";